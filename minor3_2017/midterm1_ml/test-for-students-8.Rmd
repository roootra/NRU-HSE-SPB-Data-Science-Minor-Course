---
title: "Untitled"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


В рамках практического задания, мы исследуем потребление алкоголя студентами.
Загрузите данные по студентам следующим образом.

```{r}
students<-read.csv("/principal/courses/minor3_2017/data/student-mat.csv")
```



##1 задача. ##

Постройте модель линейной регрессии с параметрами по умолчанию для предсказания переменной Walc (количество алкоголя употребляемое в выходные дни, от 1 - очень мало, до 5 - очень много), рассматривая ее как как численную переменную, по всем переменным кроме Dalc. (делить на тестовую и обучающую выборки пока не нужно)


1. Сколько статистически значимых переменных в модели? (Intercept - не переменная)
2. Согласно полученной модели, как уровень образования отца (Fedu) влияет на употребление алкоголя? Повышает или понижает и на сколько, при повышении уровня образования на единицу?
3. Какой коэффициент перед переменной, связанной с полом? 


##2 задача.##

Теперь, используя дерево регрессии, предскажите итоговый балл (G3), исходя из употребления алкоголя в будние (Dalc), платы за обучение (paid), количества пропущенных занятий (absences), желания поступить в вуз (higher) и уровня образования родителей (Medu и Fedu). Переменные (Medu, Fedu, Dalc, absence) считайте количественными. (Делить на тестовую и обучающую выборки пока не нужно)

Нарисуйте полученное дерево.

1. Укажите RSS получившейся модели.
2. Входит ли переменная, связанная с употреблением алкоголя (Dacl или Walc), в вашу модель?

Теперь постройте регрессионное дерево считая Dalc, Medu и Fedu факторами.

3. Вычислите RSS новой модели.
4. Какая из моделей лучше -- с факторными переменными или с численными?



##3 задача##
Считается, что мальчики и девочки усваивают математику по разному. Проверим, можно ли предсказать пол (sex), зная возраст (age) и три оценки по математике (G1, G2, G3). Разделите на тестовую и обучающую выборки с помощью следующего кода. Обратите внимание на set.seed()

```{r}
set.seed(999) #v8 для разных вариантов используются разные seed. Можно нагенерировать сколько угодно.
test.ind = sample(nrow(students), nrow(students)*0.3)
test.stud = students[test.ind,]
train.stud = students[-test.ind,]
```

Обучите две модели svm, одну c линейным ядлом, а вторую с полиномиальным.   

```{r}
#svm.lin.model = svm(..., kernel = "linear")
#svm.poly.model = svm(..., kernel = "polynomial")
```

Укажите Accuracy каждой из моделей на тестовой выборке (test.stud) 
- Результат модели с линейным ядром:
- Результат модели с полиномиальным ядром:
- Какая модель лучше сработала?


##4 задача.##

Постройте логистическую регрессию для предсказания пола студента, на основе всех переменных. Используйте разбиение на обучающую и тестовую выборку построенное раньше.

1. Вычислите AUC на тестовой выборке.

Мы знаем что иногда порог 0.5 может быть не самым лучшим порогом отсечения. Построить разбиение с другим порогом можно, например командой:  

```{r}
#ifelse(переменная_с_вероятностями< пороговое_значение, "F", "M")
```

Вычислите Accurasy модели на тестовой выборке используя пороги отсечения 0.4, 0.5, 0.6.

2. Укажите порог для которого Accuracy наибольшая, при равенстве Accuracy для двух моделей укажите меньший из попрогов.

3. Какая Accuracy на тестовой выборке получилась в лучшем случае?


##5 задача. ##

Как мы знаем, малое количество классов может очень сильно сказаться на качестве их определения. А чрезмерное употребление алкоголя -- это большая проблема.

Создайте новую переменную "употребляет много алкоголя" истинную, когда (Dalc принимает значение 4 или 5  /или/ Walc принимает значение 5) и исключите переменные Dalc и Walc.

Ипользуйте дерево (ctree из пакета partykit) с весами для того, чтобы построить модель предсказывающую студентов злоупотребляющих алкоголем. Используйте вес 9 для примеров злоупотребляющих и вес 1 для остальных.


```{r}

#students = students %>% mutate(Drunk = ...) %>% dplyr::select(-Dalc, -Walc)

#w<- ifelse(train.stud$Drunk, 9, 1)
#wtree<-ctree(..., weights = w)

```

1. Вычислите Accuracy построенной модели на тестовой выборке.
2. Какую долю злоупотребляющих удалось выявить в тестовой выборке (учажите число в процентах, с точностью до второго знака после запятой).
3. Сколько реально злоупотребляющих в штуках мы пропустили в тестовой выборке. Укажите здесь, в степик это число вводить не надо.


